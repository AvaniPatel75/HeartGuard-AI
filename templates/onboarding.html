{% extends "layout.html" %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gray-50 relative overflow-hidden">
    <div class="absolute inset-0 z-0 opacity-30">
        <div
            class="absolute top-0 left-0 w-96 h-96 bg-primary/20 rounded-full mix-blend-multiply filter blur-3xl animate-blob">
        </div>
        <div
            class="absolute top-0 right-0 w-96 h-96 bg-accent/20 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-2000">
        </div>
    </div>

    <div class="glass w-full max-w-2xl p-8 rounded-3xl relative z-10 shadow-2xl m-4">
        <div class="bg-white rounded-2xl shadow-inner h-96 overflow-y-auto p-6 mb-6 flex flex-col space-y-4"
            id="chat-box">
            <!-- Initial AI Message -->
            <div class="flex justify-start animate-fade-in-up">
                <div class="bg-gray-100 text-gray-800 px-4 py-3 rounded-2xl rounded-tl-none max-w-xs shadow-sm">
                    <p class="font-medium">Hello! I'm Dr. HeartGuard.</p>
                    <p class="mt-1">Before we access your dashboard, may I know your name?</p>
                </div>
            </div>

            {% for msg in chat_history %}
            <div class="flex {% if msg.role == 'user' %}justify-end{% else %}justify-start{% endif %} animate-fade-in">
                <div
                    class="{% if msg.role == 'user' %}bg-gradient-to-r from-primary to-accent text-white rounded-tr-none{% else %}bg-gray-100 text-gray-800 rounded-tl-none{% endif %} px-4 py-3 rounded-2xl max-w-xs shadow-sm">
                    {{ msg.content }}
                </div>
            </div>
            {% endfor %}
        </div>

        <form id="chat-form" method="POST" action="/onboarding" class="flex gap-4">
            <input type="text" name="message" id="message-input" required autocomplete="off"
                placeholder="Type your answer..."
                class="flex-1 rounded-xl border-gray-300 shadow-sm focus:border-primary focus:ring-primary py-3 px-4 bg-white/80 backdrop-blur">
            <button type="submit"
                class="bg-black text-white px-6 py-3 rounded-xl font-bold hover:bg-gray-800 transition-transform active:scale-95 shadow-lg">
                Send
            </button>
        </form>
    </div>
</div>

<script>
    const chatBox = document.getElementById('chat-box');
    chatBox.scrollTop = chatBox.scrollHeight;
</script>
{% endblock %}